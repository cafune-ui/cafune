{"version":3,"sources":["webpack:///../components/pull-refresh/index.jsx","webpack:///./pages/components/pull-refresh/index.js"],"names":["MIN_DISTANCE","getDirection","x","y","setTransform","obj","offsetY","style","transform","msTransform","MozTransform","webkitTransform","getScrolltop","document","documentElement","scrollTop","window","pageYOffset","body","stateMap","PullRefresh","state","status","height","pullrefresh","createRef","pullrefresh_loading","headHeight","touchStart","event","resetTouchStatus","startX","touches","clientX","startY","clientY","touchMove","touch","deltaX","deltaY","offsetX","Math","abs","direction","onTouchStart","untouchable","getCeiling","onTouchMove","ceiling","setStatus","ease","cancelable","preventDefault","onTouchEnd","props","onRefresh","componentDidMount","current","addEventListener","componentWillUnmount","removeEventListener","disabled","componentWillReceiveProps","nextProps","loading","round","isLoading","setState","render","prefix","className","children","restProps","cx","Component","defaultProps","GridComp","count","setTimeout","console","log"],"mappings":"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","file":"18.chunk.8282a.js","sourcesContent":["import { Component, createRef } from 'preact';\nimport cx from 'classnames';\nimport PropTypes from 'prop-types';\n\nconst MIN_DISTANCE = 10;\nfunction getDirection(x, y) {\n  if (x > y && x > MIN_DISTANCE) {\n    return 'horizontal';\n  }\n  if (y > x && y > MIN_DISTANCE) {\n    return 'vertical';\n  }\n  return '';\n}\n\nfunction setTransform(obj, offsetY) {\n  obj.style.transform = `translate3d(0, ${offsetY}px, 0)`;\n  obj.style.msTransform = `translate3d(0, ${offsetY}px, 0)`;\n  obj.style.MozTransform = `translate3d(0, ${offsetY}px, 0)`;\n  obj.style.webkitTransform = `translate3d(0, ${offsetY}px, 0)`;\n}\n\nfunction getScrolltop() {\n  return  document.documentElement.scrollTop || window.pageYOffset || document.body.scrollTop;\n}\nconst stateMap = {\n  'loosing': '',\n  'pulling': '释放可刷新',\n  'loading': '加载中...',\n\n}\n/**\n * 下拉刷新\n */\nclass PullRefresh extends Component {\n  static defaultProps = {\n    prefix: 'caf-pullref'\n  };\n  static propTypes = {\n    /**\n     * 自定义类名\n     */\n    prefix: PropTypes.string,\n    /**\n     * 拉动方向\n     */\n    direction: PropTypes.oneOf(['up', 'down']),\n    /**\n     * 刷新距离\n     */\n    distance: PropTypes.number,\n    /**\n     * 是否处于刷新状态\n     */\n    isRefreshing: PropTypes.bool,\n    /**\n     * 刷新回调\n     */\n    onRefresh: PropTypes.func.isRequired,\n    /**\n     * 刷新指示器\n     */\n    indicator: PropTypes.shape({\n      /**\n       * 下拉中指示器\n       */\n      pulling: PropTypes.oneOfType([PropTypes.string, PropTypes.node]),\n      /**\n       * 释放时指示器\n       */\n      loosing: PropTypes.oneOfType([PropTypes.string, PropTypes.node]),\n      /**\n       * 加载中指示器\n       */\n      loading: PropTypes.oneOfType([PropTypes.string, PropTypes.node]),\n      /**\n       * 刷新结束指示器\n       */\n      finish: PropTypes.oneOfType([PropTypes.string, PropTypes.node])\n    })\n  };\n  state = {\n    status: 'normal',\n    height: 0\n  }\n  pullrefresh = createRef();\n  pullrefresh_loading = createRef();\n  componentDidMount() {\n    if (this.pullrefresh) {\n      const pullrefresh = this.pullrefresh.current;\n      pullrefresh.addEventListener('touchstart', this.onTouchStart, false);\n      pullrefresh.addEventListener('touchmove', this.onTouchMove, false);\n      pullrefresh.addEventListener('touchend', this.onTouchEnd, false);\n      pullrefresh.addEventListener('touchcancel', this.onTouchEnd, false);\n    }\n  }\n  componentWillUnmount() {\n    if (this.pullrefresh) {\n      const pullrefresh = this.pullrefresh.current;\n      pullrefresh.removeEventListener('touchstart', this.onTouchStart, false);\n      pullrefresh.removeEventListener('touchmove', this.onTouchMove, false);\n      pullrefresh.removeEventListener('touchend', this.onTouchEnd, false);\n      pullrefresh.removeEventListener('touchcancel', this.onTouchEnd, false);\n    }\n  }\n  headHeight = 50;\n  touchStart = (event) => {\n    this.resetTouchStatus();\n    this.startX = event.touches[0].clientX;\n    this.startY = event.touches[0].clientY;\n  }\n\n  touchMove = (event) => {\n    const touch = event.touches[0];\n    this.deltaX = touch.clientX - this.startX;\n    this.deltaY = touch.clientY - this.startY;\n    this.offsetX = Math.abs(this.deltaX);\n    this.offsetY = Math.abs(this.deltaY);\n    this.direction = this.direction || getDirection(this.offsetX, this.offsetY);\n  }\n\n  resetTouchStatus = () => {\n    this.direction = '';\n    this.deltaX = 0;\n    this.deltaY = 0;\n    this.offsetX = 0;\n    this.offsetY = 0;\n  }\n  untouchable() {\n    return this.state.status === 'loading' || this.state.status === 'success' || this.props.disabled;\n  }\n  onTouchStart = (event) => {\n    // console.log('start')\n    if (!this.untouchable() && this.getCeiling()) {\n      this.touchStart(event);\n    }\n  }\n  onTouchMove = (event) => {\n    if (this.untouchable()) {\n      return;\n    }\n    this.touchMove(event);\n    if (!this.ceiling && this.getCeiling()) {\n      this.startY = event.touches[0].clientY;\n      this.deltaY = 0;\n    }\n    if (this.ceiling && this.deltaY >= 0) {\n      if (this.direction === 'vertical') {\n        this.setStatus(this.ease(this.deltaY));\n        event.cancelable && event.preventDefault();\n      }\n    }\n  }\n  getCeiling() {\n    this.ceiling = getScrolltop() === 0;\n    return this.ceiling;\n  }\n  componentWillReceiveProps(nextProps) {\n    if (!nextProps.loading) {\n      this.setStatus(0);\n    } else {\n      this.setStatus(nextProps.loading ? this.headHeight : 0, nextProps.loading);\n    }\n  }\n  ease(height) {\n    const { headHeight } = this;\n    return height < headHeight\n      ? height\n      : height < headHeight * 2\n        ? Math.round(headHeight + (height - headHeight) / 2)\n        : height > headHeight * 1.5 ? headHeight * 1.5 : Math.round(headHeight * 1.5 + (height - headHeight * 2) / 4);\n  }\n  setStatus(height, isLoading) {\n    setTransform(this.pullrefresh_loading.current, height);\n    const status = isLoading\n      ? 'loading'\n      : height === 0\n        ? 'normal'\n        : height < this.headHeight\n          ? 'pulling'\n          : 'loosing';\n    if (status !== this.state.status) {\n      this.setState({\n        status,\n      })\n    }\n  }\n  onTouchEnd = () => {\n    // console.log('end');\n    if (!this.untouchable() && this.ceiling && this.deltaY) {\n      if (this.state.status === 'loosing') {\n        this.props.onRefresh && this.props.onRefresh();\n        this.setStatus(this.headHeight, true);\n      } else {\n        this.setStatus(0);\n      }\n    }\n  }\n  render({ prefix, className, children, ...restProps }) {\n    return <div className={cx(prefix, className)} ref={ this.pullrefresh } {...restProps}>\n      <span className={`${prefix}-loading`} ref={ this.pullrefresh_loading }></span>\n      { children }\n    </div>\n  }\n}\nexport default PullRefresh;\n\n\n\n// WEBPACK FOOTER //\n// ../components/pull-refresh/index.jsx","import { PullRefresh } from 'cafune';\nimport { Component } from 'preact';\n\nexport default class GridComp extends Component {\n  state = {\n    count: 1,\n    loading: false\n  };\n  onRefresh = () => {\n    setTimeout(() => {\n      console.log('刷新成功');\n      this.setState({\n        loading: false,\n        count: this.state.count + 1\n      });\n    }, 2000);\n  };\n  render({}, { loading, count }) {\n    return (\n      <PullRefresh loading={loading} onRefresh={this.onRefresh}>\n        <div class=\"caf-demo-block\" style=\"min-height: 500px;\">\n          count: {count}\n        </div>\n      </PullRefresh>\n    );\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./pages/components/pull-refresh/index.js"],"sourceRoot":""}