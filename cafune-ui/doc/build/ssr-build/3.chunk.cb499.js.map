{"version":3,"sources":["webpack:///./pages/components/lazyload/style.scss?9aba","webpack:///../util/browser.js","webpack:///../components/lazyload/index.jsx","webpack:///./pages/components/lazyload/index.js"],"names":["getScrollTop","scrollTop","bodyScrollTop","documentScrollTop","document","body","documentElement","getScrollHeight","scrollHeight","bodyScrollHeight","documentScrollHeight","getWindowHeight","windowHeight","compatMode","clientHeight","inViewPort","ele","offsetTop","Lazyload","imgsInfo","onScroll","updateLazy","lazyContainer","createRef","componentDidMount","container","current","updateImgs","window","addEventListener","componentDidUpdate","imgs","querySelectorAll","props","imgClass","i","len","length","dataset","src","push","dom","componentWillUnmount","removeEventListener","forEach","render","children","Component","defaultProps","LazyLoadComp","Array","map","_","ind"],"mappings":"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","file":"3.chunk.cb499.js","sourcesContent":["// removed by extract-text-webpack-plugin\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./pages/components/lazyload/style.scss\n// module id = WUIe\n// module chunks = 3 29","// 文档滚动高度\nexport function getScrollTop() {\n  let scrollTop = 0;\n  let bodyScrollTop = 0;\n  let documentScrollTop = 0;\n  if (document.body) {\n    bodyScrollTop = document.body.scrollTop;\n  }\n  if (document.documentElement) {\n    documentScrollTop = document.documentElement.scrollTop;\n  }\n  scrollTop =\n    bodyScrollTop - documentScrollTop > 0 ? bodyScrollTop : documentScrollTop;\n  return scrollTop;\n}\n\n// 文档的总高度\nexport function getScrollHeight() {\n  let scrollHeight = 0;\n  let bodyScrollHeight = 0;\n  let documentScrollHeight = 0;\n  if (document.body) {\n    bodyScrollHeight = document.body.scrollHeight;\n  }\n  if (document.documentElement) {\n    documentScrollHeight = document.documentElement.scrollHeight;\n  }\n  scrollHeight =\n    bodyScrollHeight - documentScrollHeight > 0\n      ? bodyScrollHeight\n      : documentScrollHeight;\n  return scrollHeight;\n}\n\n// 浏览器视口的高度\nexport function getWindowHeight() {\n  let windowHeight = 0;\n  if (document.compatMode == 'CSS1Compat') {\n    windowHeight = document.documentElement.clientHeight;\n  } else {\n    windowHeight = document.body.clientHeight;\n  }\n  return windowHeight;\n}\n// 元素是否在视口范围内\nexport function inViewPort(ele) {\n  return (\n    getScrollTop() + getWindowHeight() >= ele.offsetTop &&\n    ele.offsetTop >= getScrollTop()\n  );\n}\n\n\n\n// WEBPACK FOOTER //\n// ../util/browser.js","import { Component, createRef } from 'preact';\nimport { inViewPort } from '../../util/browser';\nimport PropTypes from 'prop-types';\n/**\n * 懒加载包裹组件\n * @example\n * ```javascript\n * <Lazyload imgclassName=\"lazy\">\n * // ...\n * <img src=\"/placeholder\" data-src={originalpic} className=\"lazy\" />\n * // ...\n * </Lazyload>\n * ```\n */\nclass Lazyload extends Component {\n  lazyLoadIns;\n  imgsInfo = [];\n  static propTypes = {\n    /**\n     * 懒加载图片类名\n     */\n    imgClass: PropTypes.string\n  };\n  static defaultProps = {\n    imgClass: 'lazyImg'\n  };\n  container;\n  componentDidMount() {\n    const container = this.lazyContainer.current;\n    this.container = container;\n    this.updateImgs();\n    window.addEventListener('scroll', this.onScroll);\n  }\n  componentDidUpdate() {\n    /* istanbul ignore next  */\n    this.updateImgs();\n  }\n  updateImgs() {\n    if (this.container) {\n      const imgsInfo = [];\n      // eslint-disable-next-line prettier/prettier\n      const imgs = this.container.querySelectorAll(`.${this.props.imgClass}`) || [];\n      for (let i = 0, len = imgs.length; i < len; i += 1) {\n        const ele = imgs[i];\n        if (ele.dataset.src !== ele.src) {\n          imgsInfo.push({\n            dom: ele,\n            src: ele.dataset.src\n          });\n        }\n      }\n      this.imgsInfo = imgsInfo;\n      this.updateLazy();\n    }\n  }\n  componentWillUnmount() {\n    window.removeEventListener('scroll', this.onScroll);\n  }\n  updateLazy() {\n    const { imgsInfo } = this;\n    imgsInfo.forEach(ele => {\n      /* istanbul ignore else */\n      if (ele.dom.src !== ele.src && inViewPort(ele.dom)) {\n        ele.dom.src = ele.src;\n      }\n    });\n  }\n  onScroll = () => {\n    /* istanbul ignore next  */\n    this.updateLazy();\n  };\n  lazyContainer = createRef();\n  render({ children }) {\n    return (\n      <div ref={this.lazyContainer} className=\"caf-lazyload\">\n        {children}\n      </div>\n    );\n  }\n}\n\nexport default Lazyload;\n\n\n\n// WEBPACK FOOTER //\n// ../components/lazyload/index.jsx","import { Lazyload } from 'cafune';\nimport { Component } from 'preact';\nimport './style';\nexport default class LazyLoadComp extends Component {\n  render() {\n    return (\n      <Lazyload imgClass=\"lazy\">\n        {Array(...Array(20)).map((_, ind) => (\n          <div class=\"caf-demo-image\" key={ind}>\n            <img\n              src=\"https://via.placeholder.com/200x150.png?text=playholder\"\n              data-src=\"https://via.placeholder.com/200x150.png?text=original\"\n              class=\"lazy\"\n            />\n          </div>\n        ))}\n      </Lazyload>\n    );\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./pages/components/lazyload/index.js"],"sourceRoot":""}